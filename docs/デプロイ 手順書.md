🚀 Cloudflare Pages デプロイ完全ガイド

  手順1: Cloudflare Pagesダッシュボードにアクセス

  1. Cloudflareダッシュボードにログイン: https://dash.cloudflare.com/
  2. 左側メニューから「Workers & Pages」を選択
  3. 「Create application」→「Pages」タブ→「Connect to Git」をクリック

  ---
  手順2: GitHubリポジトリを接続

  1. GitHubアカウントを接続
    - 初回の場合、GitHubの認証画面が表示されます
    - 「Authorize Cloudflare Pages」をクリック
  2. リポジトリを選択
    - リポジトリ一覧から masa162/unbelongcomic を選択
    - または検索窓で「unbelongcomic」と入力

  ---
  手順3: ビルド設定（重要）

  以下の設定を正確に入力してください：

  📋 設定項目

  | 項目                        | 設定値                                           |
  |---------------------------|-----------------------------------------------|
  | Project name              | unbelong-comic または comic-unbelong             |
  | Production branch         | main                                          |
  | Framework preset          | Next.js                                       |
  | Build command             | cd apps/comic && npm install && npm run build |
  | Build output directory    | apps/comic/.next                              |
  | Root directory (advanced) | 空欄のまま（ルートディレクトリを使用）                           |

  🔧 環境変数

  「Environment variables (advanced)」セクションで以下を追加：

  | Variable name       | Value                                         |
  |---------------------|-----------------------------------------------|
  | NODE_VERSION        | 20.19.5                                       |
  | NEXT_PUBLIC_API_URL | https://api.unbelong.xyz (後でWorkerをデプロイしたURL) |

  ---
  手順4: デプロイ開始

  1. 「Save and Deploy」をクリック
  2. ビルドプロセスが開始されます（5-10分程度）
  3. ログを確認しながら待ちます

  ---
  手順5: カスタムドメイン設定

  デプロイが成功したら：

  1. プロジェクトの「Settings」→「Domains」に移動
  2. 「Add a custom domain」をクリック
  3. comic.unbelong.xyz を入力
  4. 「Continue」→「Activate domain」

  Cloudflareが自動的にDNSレコードを設定します（既にunbelong.xyzのDNSがCloudflareで管理されている場
  合）

  ---
  ⚠️ よくある問題と解決方法

  問題1: ビルドが失敗する

  原因: モノレポ構成のため、依存関係が見つからない

  解決策: Build commandを以下に変更：
  npm install && cd apps/comic && npm install && npm run build

  ---
  問題2: 「Module not found: @unbelong/shared」エラー

  原因: 共有パッケージがビルドされていない

  解決策: Build commandを以下に変更：
  npm install && cd packages/shared && npm run build && cd ../../apps/comic && npm install && npm
  run build

  ---
  問題3: 環境変数が反映されない

  解決策:
  1. Cloudflare Pagesの「Settings」→「Environment variables」で確認
  2. 変更後は「Retry deployment」でビルドをやり直す

  ---
  📸 スクリーンショット付き手順（重要な画面）

  ビルド設定画面で入力する内容:

  Framework preset: Next.js

  Build command:
  npm install && cd packages/shared && npm run build && cd ../../apps/comic && npm install && npm
  run build

  Build output directory:
  apps/comic/.next

  Root directory:
  (空欄)

  Environment variables:
  NODE_VERSION = 20.19.5
  NEXT_PUBLIC_API_URL = https://api.unbelong.xyz

  ---
  ✅ デプロイ成功後の確認

  1. デフォルトURLでアクセス: https://unbelong-comic.pages.dev
  2. カスタムドメインでアクセス: https://comic.unbelong.xyz
  3. 各ページが正しく表示されるか確認：
    - トップページ: /
    - 作者ページ: /about
    - 作品ページ: /works/作品スラッグ (データがある場合)

  ---
  🔄 今後の更新方法

  自動デプロイが設定されています：

  git add .
  git commit -m "更新内容"
  git push origin main

  → Cloudflare Pagesが自動的に検知して再ビルド・デプロイします！

  ---
  📝 補足情報

  Next.js on Cloudflare Pagesの制限事項

  Cloudflare PagesはNext.jsの静的エクスポートモード（SSG）で動作します：
  - ✅ Server Components（データフェッチ）は動作
  - ✅ 動的ルーティング（[slug]）は動作
  - ❌ API Routes（/api/*）は動作しない（Workers APIを使用）
  - ❌ Middleware は制限あり

  今回のマンガサイトは全てSSGで構築されているため、完全に動作します。